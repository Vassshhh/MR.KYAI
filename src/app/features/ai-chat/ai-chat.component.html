<div class="chat-page-container">
    <header class="chat-header">
        <div class="header-left">
            <button pButton type="button" icon="pi pi-bars" class="p-button-text p-button-secondary" (click)="sidebarVisible = true"></button>
        </div>
        <div class="header-center">
            <h4 class="fw-bold mb-0">MAYA</h4>
            <span class="d-block small text-muted">Virtual Agent BAPENDA</span>
        </div>
        <div class="header-right">
            <img src="/assets/images/logo_pemprov_jatim.png" alt="Logo" class="logo-img">
        </div>
    </header>

    <div class="chat-messages" #chatMessagesContainer>
        <div *ngFor="let msg of messages$ | async" 
             class="chat-bubble"
             [ngClass]="{ 'ai': msg.role === 'ai', 'user': msg.role === 'user' }">
            
            <div *ngIf="msg.role === 'ai'" class="chat-icon">
                <img src="/assets/images/ai-agent-chat.png" alt="AI Avatar">
            </div>

            <div class="chat-text">
                <div *ngIf="msg.isLoading" class="typing-indicator">
                    <span></span><span></span><span></span>
                </div>
                <div *ngIf="!msg.isLoading" [innerHTML]="msg.text | marked"></div>
            </div>
        </div>
    </div>

    <div class="chat-input-area">
        <div class="p-inputgroup">
            <button pButton icon="pi pi-paperclip" class="p-button-secondary"></button>
            <input type="text" pInputText placeholder="Tanyakan apa saja..." 
                   [(ngModel)]="newMessage" (keyup.enter)="sendMessage()">
            <button pButton icon="pi pi-microphone" class="p-button-secondary"></button>
            <button pButton icon="pi pi-send" (click)="sendMessage()" [disabled]="!newMessage.trim()"></button>
        </div>
    </div>
</div>

<p-sidebar [(visible)]="sidebarVisible" position="left">
    <ng-template pTemplate="header">Menu</ng-template>
    <div class="flex flex-column h-full">
        <div class="mt-auto">
             <p-button label="Hapus Riwayat Chat" icon="pi pi-trash" styleClass="p-button-danger p-button-outlined w-full" (click)="clearHistory()"></p-button>
        </div>
    </div>
</p-sidebar>
