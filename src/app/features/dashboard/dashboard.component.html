<div class="grid dashboard-grid">

  <!-- Progress Stepper + Top Topics -->
  <div class="col-12">
    <div class="leveling-topics">

      <!-- Progress Stepper -->
      <div class="left-card">
        <p-card styleClass="h-full">
          <div class="progress-stepper">
  <input type="radio" name="step" id="step-1" [(ngModel)]="selectedLevel" [value]="1">
  <input type="radio" name="step" id="step-2" [(ngModel)]="selectedLevel" [value]="2">
  <input type="radio" name="step" id="step-3" [(ngModel)]="selectedLevel" [value]="3">
  <input type="radio" name="step" id="step-4" [(ngModel)]="selectedLevel" [value]="4">
  <input type="radio" name="step" id="step-5" [(ngModel)]="selectedLevel" [value]="5">

  <div class="progress-steps-wrapper">
  <label for="step-1" class="progress-stepper__step" data-level="1">
    <i [ngClass]="getStepIcon(1)"></i><span>Lv 1</span>
  </label>
  <label for="step-2" class="progress-stepper__step" data-level="2">
    <i [ngClass]="getStepIcon(2)"></i><span>Lv 2</span>
  </label>
  <label for="step-3" class="progress-stepper__step" data-level="3">
    <i [ngClass]="getStepIcon(3)"></i><span>Lv 3</span>
  </label>
  <label for="step-4" class="progress-stepper__step" data-level="4">
    <i [ngClass]="getStepIcon(4)"></i><span>Lv 4</span>
  </label>
  <label for="step-5" class="progress-stepper__step" data-level="5">
    <i [ngClass]="getStepIcon(5)"></i><span>Lv 5</span>
  </label>
</div>

</div>

          <div class="level-info-container mt-3">
            <ng-container *ngFor="let info of levelInfo">
              <div *ngIf="info.level === selectedLevel">
                <h4>{{ info.title }}</h4>
                <ul class="level-tasks">
                  <li *ngFor="let task of info.tasks">{{ task }}</li>
                </ul>
              </div>
            </ng-container>
          </div>
        </p-card>
      </div>

      <!-- Top Topics (Clickable) -->
      <div class="right-card">
        <p-card styleClass="h-full cursor-pointer" (click)="openTopTopicsModal()">
          <ng-template pTemplate="title">
            <div class="flex align-items-center">
              <div class="icon-circle-sm top-topic itop">
                <i class="pi pi-asterisk"></i>
              </div>
              <span class="top-pic itop">Top Topics</span>
            </div>
          </ng-template>
          <ul class="list-none p-0 m-0">
            <li *ngFor="let topic of getTopThreeTopics(); let i = index" 
                class="summary-item flex justify-content-between align-items-center"
                [ngClass]="topic.color === 'nat-1' ? 'naz-1' : topic.color === 'nat-2' ? 'naz-2' : 'naz-3'">
              <span class="flex align-items-center">
                <div class="tiny-dot" [ngClass]="topic.color"></div>
                <span class="summary-text ml-2">{{ topic.topic }}</span>
              </span>
              <span class="summary-value">{{ topic.count }}</span>
            </li>
          </ul>
        </p-card>
      </div>
    </div>
  </div>

<!-- Overview Cards -->
<div class="col-12">
  <div class="leveling-topics">

    <!-- Total User -->
    <div class="left-card">
      <p-card styleClass="overview-card h-full ">
        <div class="overview-content combine ">
          <div class="icon-circle primary">
            <i class="pi pi-users"></i>
          </div>
          <div class="overview-text">
            <h6 class="card-title">Total User per day</h6>
            <h3 class="card-value">1,250</h3>
          </div>
        </div>
      </p-card>
    </div>

    <!-- AI Response -->
    <div class="right-card">
      <p-card styleClass="overview-card h-full">
        <div class="overview-content">
          <div class="icon-circle secondary">
            <i class="pi pi-comments"></i>
          </div>
          <div class="overview-text">
            <h6 class="card-title">Avg. Time AI Response</h6>
            <h3 class="card-value">3 Sec</h3>
          </div>
        </div>
      </p-card>
    </div>

  </div>
</div>


  <!-- Charts -->
  <div class="col-12">
    <div class="leveling-topics">
      <div class="left-card">
        <p-card styleClass="h-full">
          <ng-template pTemplate="title">
            <span class="card-header-title">Platform Access</span>
          </ng-template>
          <p-chart 
  type="doughnut" 
  [data]="platformAccessData" 
  [options]="platformAccessChartOptions" 
  height="250px">
</p-chart>
        </p-card>
      </div>
      <div class="right-card">
        <p-card styleClass="h-full">
          <ng-template pTemplate="title">
            <span class="card-header-title">Analisis Penerimaan Pajak (2025)</span>
          </ng-template>
          <p-chart 
  type="line" 
  [data]="taxRevenueData" 
  [options]="chartOptions" 
  height="250px">
</p-chart>
        </p-card>
      </div>
    </div>
  </div>

</div>

<!-- Modal Top Topics -->
<p-dialog 
  [(visible)]="displayTopTopicsModal" 
  [modal]="true" 
  [closable]="true"
  [draggable]="false"
  [resizable]="false"
  styleClass="top-topics-modal"
  [style]="{ width: '600px', maxWidth: '90vw' }">
  
  <ng-template pTemplate="header">
    <div class="flex align-items-center">
      <div class="icon-circle-sm top-topic me-3">
        <i class="pi pi-asterisk"></i>
      </div>
      <h5 class="fw-bold mb-0">Semua Topik Pertanyaan</h5>
    </div>
  </ng-template>

  <ng-template pTemplate="content">
    <!-- Search Input -->
    <div class="p-inputgroup search mb-3">
      <span class="p-inputgroup-addon">
        <i class="pi pi-search form-control"></i>
      </span>
      <input type="text" 
             pInputText 
             [(ngModel)]="topicSearchValue"
             (input)="onTopicSearch()"
             placeholder="Cari topik..." 
             class="form-control">
    </div>

    <!-- Topics List -->
    <div class="topics-list" style="max-height: 400px; overflow-y: auto;">
      <ul class="list-none p-0 m-0">
        <li *ngFor="let topic of filteredTopics; let i = index" 
            class="summary-item flex justify-content-between align-items-center mb-2"
            [ngClass]="topic.color === 'nat-1' ? 'naz-1' : topic.color === 'nat-2' ? 'naz-2' : 'naz-3'">
          <span class="flex align-items-center">
            <div class="tiny-dot me-2" [ngClass]="topic.color"></div>
            <span class="summary-text">{{ topic.topic }}</span>
          </span>
          <span class="summary-value badge bg-danger rounded-pill">{{ topic.count }}</span>
        </li>
      </ul>

      <!-- No Results Message -->
      <div *ngIf="filteredTopics.length === 0" class="text-center py-4">
        <i class="pi pi-search text-muted" style="font-size: 2rem;"></i>
        <p class="text-muted mt-2">Tidak ada topik yang ditemukan</p>
      </div>
    </div>
  </ng-template>

  

</p-dialog>